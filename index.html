<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="SmartChat AI - Chat with AI or your documents. Upload PDFs and get intelligent answers."
    />
    <title>SmartChat AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
        background-color: #f3e8ff;
        min-height: 100vh;
        font-family: Arial, sans-serif;
      }
      .card {
        display: flex;
        flex-direction: column;
        height: 100vh;
        width: 95%;
        margin: 0 auto;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }
      .header {
        display: flex;
        align-items: center;
        padding: 16px;
        border-bottom: 1px solid #d1d5db;
        position: relative;
        background: linear-gradient(to right, #8b5cf6, #4f46e5);
      }
      .chat-header {
        display: flex;
        align-items: center;
        padding: 16px;
        border-bottom: 1px solid #d1d5db;
        position: relative;
        background: #d1d5db;
      }
      .header .title,
      .chat-header .title {
        color: white;
        padding: 8px;
        font-size: 24px;
        font-weight: 600;
      }
      .chat-header .title {
        flex: 1;
        text-align: center;
        color: black;
      }
      .header .back-btn,
      .chat-header .back-btn {
        background: none;
        border: none;
        cursor: pointer;
        position: absolute;
        left: 16px;
        padding: 8px;
        color: white;
      }
      .chat-header .back-btn {
        color: black;
      }
      .chat-header .menu-container {
        position: absolute;
        right: 16px;
      }
      .chat-header .menu-btn {
        padding: 8px;
        background: none;
        border: none;
        font-size: 16px;
        cursor: pointer;
        color: black;
      }
      .dropdown {
        position: absolute;
        top: 100%;
        right: 0;
        width: 192px;
        background: white;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        border-radius: 4px;
        display: none;
        z-index: 10;
      }
      .menu-container:hover .dropdown {
        display: block;
      }
      .dropdown div {
        padding: 8px;
        cursor: pointer;
      }
      .dropdown div:hover {
        background-color: #f3e8ff;
      }
      .nav-link {
        position: relative;
      }
      .nav-link::after {
        content: "";
        position: absolute;
        width: 0;
        height: 2px;
        bottom: -2px;
        left: 0;
        background-color: white;
        transition: width 0.3s ease;
      }
      .nav-link:hover::after {
        width: 100%;
      }
      .content-area {
        flex: 1;
        padding: 16px;
        overflow-y: auto;
      }
      .welcome-message {
        text-align: center;
        margin-top: 160px;
        color: #4b5563;
      }
      .welcome-message p:first-child {
        font-size: 20px;
      }
      .message {
        display: flex;
        margin: 8px 0;
      }
      .message.user {
        justify-content: flex-end;
      }
      .message.ai {
        justify-content: flex-start;
      }
      .message span {
        padding: 8px 16px;
        border-radius: 8px;
        max-width: 70%;
      }
      .message.user span {
        background-color: #8b5cf6;
        color: white;
      }
      .message.ai span {
        background-color: #d1d5db;
        color: black;
      }
      .loading span {
        background-color: #d1d5db;
        color: black;
        padding: 8px 16px;
        border-radius: 8px;
      }
      .input-area {
        display: flex;
        gap: 8px;
        padding: 16px;
        border-top: 1px solid #d1d5db;
        align-items: center;
      }
      .input-area input[type="text"] {
        flex: 1;
        padding: 8px;
        border: 1px solid #d1d5db;
        border-radius: 4px;
        font-size: 16px;
      }
      .input-area input[type="file"] {
        display: none;
      }
      .input-area .upload-btn {
        padding: 8px;
        background-color: #8b5cf6;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
      }
      .input-area .upload-btn:hover {
        background-color: #7c3aed;
      }
      .input-area button {
        padding: 8px 16px;
        background-color: #8b5cf6;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      .input-area button:hover {
        background-color: #7c3aed;
      }
      .paper-plane,
      .back-icon,
      .upload-icon {
        width: 20px;
        height: 20px;
      }
      .hidden {
        display: none;
      }
      .feature-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
      }
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 20;
      }
      .modal-content {
        background: white;
        padding: 24px;
        border-radius: 8px;
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
      }
      .modal-content h3 {
        margin-top: 0;
      }
      .modal-content button {
        margin-top: 16px;
        padding: 8px 16px;
        background-color: #8b5cf6;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      .modal-content button:hover {
        background-color: #7c3aed;
      }
      .profile-actions button {
        margin: 8px;
        padding: 10px 20px;
        background-color: #8b5cf6;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
      }
      .profile-actions button:hover {
        background-color: #7c3aed;
      }
      .contact-info p {
        margin: 8px 0;
        color: #4b5563;
      }
      .contact-form {
        margin-top: 16px;
      }
      .contact-form label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #4b5563;
      }
      .contact-form input,
      .contact-form textarea {
        width: 100%;
        padding: 8px;
        margin-bottom: 16px;
        border: 1px solid #d1d5db;
        border-radius: 4px;
        font-size: 16px;
      }
      .contact-form button {
        padding: 8px 16px;
        background-color: #8b5cf6;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      .contact-form button:hover {
        background-color: #7c3aed;
      }
    </style>
  </head>
  <body>
    <!-- Main Header -->
    <div class="header">
      <div class="title">SmartChat AI</div>
      <nav class="absolute right-16 top-1/2 transform -translate-y-1/2">
        <div class="flex space-x-4">
          <a
            href="#"
            class="nav-link px-3 py-2 rounded-md text-sm font-medium text-white"
            onclick="navigate('home')"
            >Home</a
          >
          <a
            href="#"
            class="nav-link px-3 py-2 rounded-md text-sm font-medium text-white"
            onclick="navigate('general')"
            >AI Chat</a
          >
          <a
            href="#"
            class="nav-link px-3 py-2 rounded-md text-sm font-medium text-white"
            onclick="navigate('pdf')"
            >PDF Chat</a
          >
          <a
            href="#"
            class="nav-link px-3 py-2 rounded-md text-sm font-medium text-white"
            onclick="navigate('history')"
            >History</a
          >
          <a
            href="#"
            class="nav-link px-3 py-2 rounded-md text-sm font-medium text-white"
            onclick="navigate('help')"
            >Help</a
          >
          <a
            href="#"
            class="nav-link px-3 py-2 rounded-md text-sm font-medium text-white"
            onclick="navigate('profile')"
            >Profile</a
          >
        </div>
      </nav>
    </div>

    <!-- Home Section (no card) -->
    <div id="home" class="content-area">
      <div class="py-12 px-6">
        <div class="max-w-4xl mx-auto text-center">
          <h2 class="text-4xl font-bold text-gray-900 mb-4">
            Welcome to SmartChat AI
          </h2>
          <p class="text-xl text-gray-600 mb-8">
            Transform how you interact with documents using AI-powered
            conversations.
          </p>
          <div class="flex justify-center gap-4">
            <a
              href="#"
              onclick="navigate('general')"
              class="px-8 py-4 bg-purple-600 text-white rounded-lg text-lg font-semibold hover:bg-purple-700"
              >Start Chat Now</a
            >
            <a
              href="#"
              onclick="navigate('pdf')"
              class="px-8 py-4 bg-transparent border-2 border-purple-600 text-purple-600 rounded-lg text-lg font-semibold hover:bg-purple-50"
              >Upload a PDF</a
            >
          </div>
        </div>
      </div>
      <!-- Key Features -->
      <div class="py-16 px-6 bg-white">
        <div class="max-w-6xl mx-auto">
          <h3 class="text-3xl font-bold text-center text-gray-900 mb-12">
            Key Features
          </h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-8">
            <div
              class="feature-card p-6 bg-gray-50 rounded-xl text-center transition-all duration-300 hover:bg-purple-50"
            >
              <span class="text-5xl mb-4 block">üí¨</span>
              <h4 class="text-xl font-semibold text-gray-900 mb-2">
                Chat with AI
              </h4>
              <p class="text-gray-600">
                Engage in natural conversations with our advanced AI.
              </p>
            </div>
            <div
              class="feature-card p-6 bg-gray-50 rounded-xl text-center transition-all duration-300 hover:bg-purple-50"
            >
              <span class="text-5xl mb-4 block">üìÑ</span>
              <h4 class="text-xl font-semibold text-gray-900 mb-2">
                Upload PDF
              </h4>
              <p class="text-gray-600">
                Ask questions about your uploaded PDF documents.
              </p>
            </div>
            <div
              class="feature-card p-6 bg-gray-50 rounded-xl text-center transition-all duration-300 hover:bg-purple-50"
            >
              <span class="text-5xl mb-4 block">üìú</span>
              <h4 class="text-xl font-semibold text-gray-900 mb-2">
                Chat History
              </h4>
              <p class="text-gray-600">
                Revisit your previous chats with ease.
              </p>
            </div>
            <div
              class="feature-card p-6 bg-gray-50 rounded-xl text-center transition-all duration-300 hover:bg-purple-50"
            >
              <span class="text-5xl mb-4 block">üåô</span>
              <h4 class="text-xl font-semibold text-gray-900 mb-2">
                Availability
              </h4>
              <p class="text-gray-600">Anytime anywhere you can use it.</p>
            </div>
            <div
              class="feature-card p-6 bg-gray-50 rounded-xl text-center transition-all duration-300 hover:bg-purple-50"
            >
              <span class="text-5xl mb-4 block">üîê</span>
              <h4 class="text-xl font-semibold text-gray-900 mb-2">
                Secure & Private
              </h4>
              <p class="text-gray-600">Your data is protected and private.</p>
            </div>
          </div>
        </div>
      </div>
      <!-- How It Works -->
      <div class="py-16 px-6 bg-purple-50">
        <div class="max-w-4xl mx-auto">
          <h3 class="text-3xl font-bold text-center text-gray-900 mb-12">
            How It Works
          </h3>
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-8">
            <div
              class="p-6 bg-white rounded-xl text-center shadow-sm hover:shadow-md transition-shadow"
            >
              <div
                class="w-12 h-12 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center mx-auto text-xl font-bold mb-4"
              >
                1
              </div>
              <h4 class="text-xl font-semibold text-gray-900 mb-2">
                Upload a PDF
              </h4>
              <p class="text-gray-600">
                Easily upload your PDF documents to start.
              </p>
            </div>
            <div
              class="p-6 bg-white rounded-xl text-center shadow-sm hover:shadow-md transition-shadow"
            >
              <div
                class="w-12 h-12 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center mx-auto text-xl font-bold mb-4"
              >
                2
              </div>
              <h4 class="text-xl font-semibold text-gray-900 mb-2">
                Ask Questions
              </h4>
              <p class="text-gray-600">
                Type your questions about the document or anything else.
              </p>
            </div>
            <div
              class="p-6 bg-white rounded-xl text-center shadow-sm hover:shadow-md transition-shadow"
            >
              <div
                class="w-12 h-12 bg-purple-100 text-purple-600 rounded-full flex items-center justify-center mx-auto text-xl font-bold mb-4"
              >
                3
              </div>
              <h4 class="text-xl font-semibold text-gray-900 mb-2">
                Get Answers
              </h4>
              <p class="text-gray-600">
                Receive accurate answers with document references.
              </p>
            </div>
          </div>
        </div>
      </div>
      <!-- What Users Say -->
      <div class="py-16 px-6 bg-white">
        <div class="max-w-4xl mx-auto">
          <h3 class="text-3xl font-bold text-center text-gray-900 mb-12">
            What Users Say
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="p-6 bg-gray-50 rounded-xl">
              <div class="flex items-center mb-4">
                <div
                  class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center mr-4"
                >
                  <span class="text-purple-600">JD</span>
                </div>
                <div>
                  <h4 class="font-semibold text-gray-900">John D.</h4>
                  <p class="text-sm text-gray-500">Researcher</p>
                </div>
              </div>
              <p class="text-gray-700">
                "SmartChat AI has revolutionized how I interact with research
                papers. I can quickly find information without reading entire
                documents."
              </p>
            </div>
            <div class="p-6 bg-gray-50 rounded-xl">
              <div class="flex items-center mb-4">
                <div
                  class="w-10 h-10 bg-purple-100 rounded-full flex items-center justify-center mr-4"
                >
                  <span class="text-purple-600">SM</span>
                </div>
                <div>
                  <h4 class="font-semibold text-gray-900">Sarah M.</h4>
                  <p class="text-sm text-gray-500">Student</p>
                </div>
              </div>
              <p class="text-gray-700">
                "As a student, this tool saves me hours of study time. The AI
                explains complex concepts from my textbooks in simple terms."
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Card for Other Sections -->
    <div class="card hidden" id="card">
      <!-- General Chat Section Header -->
      <div id="general-header" class="chat-header hidden">
        <button class="back-btn" onclick="navigate('home')">
          <svg
            class="back-icon"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M15 18l-6-6 6-6" />
          </svg>
        </button>
        <div class="title">AI Chat</div>
        <div class="menu-container">
          <button class="menu-btn">‚ò∞</button>
          <div class="dropdown">
            <div onclick="newChat('general')">New Chat</div>
            <div onclick="showChatHistory()">Chat History</div>
            <div onclick="exportChat('general')">Export Chat</div>
          </div>
        </div>
      </div>

      <!-- PDF Chat Section Header -->
      <div id="pdf-header" class="chat-header hidden">
        <button class="back-btn" onclick="navigate('home')">
          <svg
            class="back-icon"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M15 18l-6-6 6-6" />
          </svg>
        </button>
        <div class="title">PDF Chat</div>
        <div class="menu-container">
          <button class="menu-btn">‚ò∞</button>
          <div class="dropdown">
            <div onclick="newChat('pdf')">New Chat</div>
            <div onclick="showChatHistory()">Chat History</div>
            <div onclick="exportChat('pdf')">Export Chat</div>
          </div>
        </div>
      </div>

      <!-- Other Sections Header -->
      <div id="default-header" class="chat-header hidden">
        <button class="back-btn" onclick="navigate('home')">
          <svg
            class="back-icon"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M15 18l-6-6 6-6" />
          </svg>
        </button>
        <div class="title" id="section-title">Section</div>
      </div>

      <!-- General Chat Content -->
      <div id="general" class="content-area hidden">
        <div class="welcome-message" id="general-welcome">
          <p>üëã Hello! I'm your AI assistant</p>
          <p>
            Start typing your question below... I'm here to help with anything
            you need
          </p>
        </div>
      </div>
      <div id="general-input" class="input-area hidden">
        <input
          type="text"
          id="general-chat-input"
          placeholder="Type your message..."
        />
        <button onclick="sendMessage('general')">
          <svg
            class="paper-plane"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M2 12l20-10-10 20-2-4-8 2z" />
          </svg>
        </button>
      </div>

      <!-- PDF Chat Content -->
      <div id="pdf" class="content-area hidden">
        <div class="welcome-message" id="pdf-welcome">
          <p>üëã Hello! I'm your PDF AI assistant</p>
          <p>Upload a PDF or type your question below...</p>
        </div>
      </div>
      <div id="pdf-input" class="input-area hidden">
        <label for="pdf-upload" class="upload-btn">
          <svg
            class="upload-icon"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
            <path d="M17 8l-5-5-5 5" />
            <path d="M12 3v12" />
          </svg>
        </label>
        <input type="file" id="pdf-upload" accept="application/pdf" />
        <input
          type="text"
          id="pdf-chat-input"
          placeholder="Type your message..."
        />
        <button onclick="sendMessage('pdf')">
          <svg
            class="paper-plane"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M2 12l20-10-10 20-2-4-8 2z" />
          </svg>
        </button>
      </div>

      <!-- History Section -->
      <div id="history" class="content-area hidden">
        <div class="p-6 text-center">
          <h3 class="text-2xl font-bold text-gray-900 mb-4">Chat History</h3>
          <p class="text-gray-600">Your previous chats will appear here.</p>
          <div id="history-list" class="space-y-4 mt-4"></div>
        </div>
      </div>

      <!-- Help Section -->
      <div id="help" class="content-area hidden">
        <div class="p-6">
          <h3 class="text-2xl font-bold text-gray-900 mb-4">Help</h3>
          <div class="space-y-4">
            <div class="bg-gray-50 p-4 rounded-lg">
              <h4 class="text-lg font-semibold text-gray-900">
                How does SmartChat AI work?
              </h4>
              <p class="text-gray-600">
                SmartChat AI uses advanced natural language processing to
                understand your questions and provide accurate answers based on
                the documents you upload or general knowledge.
              </p>
            </div>
            <div class="bg-gray-50 p-4 rounded-lg">
              <h4 class="text-lg font-semibold text-gray-900">
                What file formats are supported?
              </h4>
              <p class="text-gray-600">
                Currently, we support PDF files. We're working on adding support
                for more document types in the future.
              </p>
            </div>
            <div class="bg-gray-50 p-4 rounded-lg">
              <h3 class="text-2xl font-bold text-gray-900 mb-4">Support</h3>
              <div class="contact-form">
                <h4 class="text-lg font-semibold text-gray-900 mb-4">
                  Contact Us
                </h4>
                <div>
                  <label for="contact-name">Name</label>
                  <input
                    type="text"
                    id="contact-name"
                    placeholder="Your name"
                    required
                  />
                </div>
                <div>
                  <label for="contact-email">Email</label>
                  <input
                    type="email"
                    id="contact-email"
                    placeholder="Your email"
                    required
                  />
                </div>
                <div>
                  <label for="contact-message">Message</label>
                  <textarea
                    id="contact-message"
                    rows="4"
                    placeholder="Your message"
                    required
                  ></textarea>
                </div>
                <button onclick="submitContactForm()">Submit</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Profile Section -->
      <div id="profile" class="content-area hidden">
        <div class="p-6 text-center">
          <!-- <h3 class="text-2xl font-bold text-gray-900 mb-4">User Profile</h3> -->
          <p class="text-gray-600 mb-4">Manage your account details here.</p>
          <div class="mt-4 mb-4">
            <p class="text-gray-600">Username: Guest</p>
            <p class="text-gray-600">Email: guest@example.com</p>
          </div>
          <div class="profile-actions">
            <button onclick="showLoginModal()">Login</button>
            <button onclick="showSignupModal()">Sign Up</button>
            <button onclick="logout()">Log Out</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      let messages = { general: [], pdf: [] };
      let history = [];
      let loading = { general: false, pdf: false };
      let firstLoad = { general: true, pdf: true };
      let currentPage = "home";
      let pdfText = "";

      const sections = {
        general: {
          area: document.getElementById("general"),
          input: document.getElementById("general-input"),
        },
        pdf: {
          area: document.getElementById("pdf"),
          input: document.getElementById("pdf-input"),
        },
        history: { area: document.getElementById("history"), input: null },
        help: { area: document.getElementById("help"), input: null },
        profile: { area: document.getElementById("profile"), input: null },
        home: { area: document.getElementById("home"), input: null },
      };
      const card = document.getElementById("card");

      const generalInput = document.getElementById("general-chat-input");
      const pdfInput = document.getElementById("pdf-chat-input");
      const pdfUpload = document.getElementById("pdf-upload");
      const generalWelcome = document.getElementById("general-welcome");
      const pdfWelcome = document.getElementById("pdf-welcome");
      const historyList = document.getElementById("history-list");

      function navigate(page) {
        currentPage = page;

        // Hide all headers first
        document.getElementById("general-header").classList.add("hidden");
        document.getElementById("pdf-header").classList.add("hidden");
        document.getElementById("default-header").classList.add("hidden");

        // Show the appropriate header
        if (page === "general") {
          document.getElementById("general-header").classList.remove("hidden");
        } else if (page === "pdf") {
          document.getElementById("pdf-header").classList.remove("hidden");
        } else {
          document.getElementById("default-header").classList.remove("hidden");
          document.getElementById("section-title").textContent =
            page === "history"
              ? "History"
              : page === "help"
              ? "Help & Support"
              : page === "profile"
              ? "Profile"
              : "Section";
        }

        // Rest of the navigation logic
        Object.keys(sections).forEach((key) => {
          sections[key].area.classList.add("hidden");
          if (sections[key].input) sections[key].input.classList.add("hidden");
        });
        sections[page].area.classList.remove("hidden");
        if (sections[page].input)
          sections[page].input.classList.remove("hidden");
        card.classList.toggle("hidden", page === "home");

        if (page === "general" || page === "pdf") renderMessages(page);
        if (page === "history") renderHistory();
        closeModal();
      }

      function renderMessages(page) {
        const chatArea = sections[page].area;
        chatArea.innerHTML = "";
        if (firstLoad[page] && messages[page].length === 0) {
          chatArea.appendChild(
            page === "general" ? generalWelcome : pdfWelcome
          );
        } else {
          messages[page].forEach((msg, index) => {
            const messageDiv = document.createElement("div");
            messageDiv.className = `message ${msg.sender}`;
            const messageSpan = document.createElement("span");
            messageSpan.innerHTML = msg.text;
            messageDiv.appendChild(messageSpan);
            chatArea.appendChild(messageDiv);
          });
          if (loading[page]) {
            const loadingDiv = document.createElement("div");
            loadingDiv.className = "message ai loading";
            loadingDiv.innerHTML = "<span>Typing...</span>";
            chatArea.appendChild(loadingDiv);
          }
          chatArea.scrollTop = chatArea.scrollHeight;
        }
      }

      function renderHistory() {
        historyList.innerHTML = "";
        if (history.length === 0) {
          historyList.innerHTML =
            '<p class="text-gray-600">No chat history available.</p>';
        } else {
          history.forEach((item, index) => {
            const historyItem = document.createElement("div");
            historyItem.className = "bg-gray-50 p-4 rounded-lg";
            historyItem.innerHTML = `
            <p class="font-semibold text-gray-900">Q: ${item.question}</p>
            <p class="text-gray-600">A: ${item.answer}</p>
          `;
            historyList.appendChild(historyItem);
          });
        }
      }

      async function sendMessage(page) {
        const input = page === "general" ? generalInput : pdfInput;
        const text = input.value.trim();
        if (!text) return;

        messages[page].push({ sender: "user", text });
        input.value = "";
        loading[page] = true;
        firstLoad[page] = false;
        renderMessages(page);

        const formattedHistory = messages[page].map((msg) => ({
          role: msg.sender === "user" ? "user" : "model",
          parts: [{ text: msg.text }],
        }));

        let promptText = text;
        if (page === "pdf" && pdfText) {
          promptText = `Use the following PDF content to answer the question:\n${pdfText}\n\nQuestion: ${text}`;
        }

        const requestBody = {
          contents: [
            ...formattedHistory,
            { role: "user", parts: [{ text: promptText }] },
          ],
          generationConfig: { responseMimeType: "text/plain" },
        };

        try {
          const response = await fetch(
            "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=AIzaSyAAGHSiWbVv_YMyvDspSrd7CT9y2HKpsGw",
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(requestBody),
            }
          );

          const data = await response.json();
          loading[page] = false;

          if (data.candidates && data.candidates.length > 0) {
            let aiResponseText = data.candidates[0].content.parts[0].text;
            aiResponseText = aiResponseText
              .replace(/\*\*(.*?)\*\*/g, "<b>$1</b>")
              .replace(/- /g, "‚Ä¢ ");

            messages[page].push({ sender: "ai", text: aiResponseText });
            history.push({ question: text, answer: aiResponseText });
          } else {
            messages[page].push({ sender: "ai", text: "Sorry, no response." });
          }
        } catch (error) {
          loading[page] = false;
          messages[page].push({
            sender: "ai",
            text: "Error fetching response.",
          });
        }
        renderMessages(page);
      }

      function newChat(page) {
        messages[page] = [];
        firstLoad[page] = true;
        pdfText = ""; // Reset PDF text for PDF chat
        renderMessages(page);
      }

      function showChatHistory() {
        const modal = document.createElement("div");
        modal.className = "modal";
        modal.innerHTML = `
        <div class="modal-content">
          <h3 class="text-2xl font-bold text-gray-900 mb-4">Chat History</h3>
          <div id="modal-history" class="space-y-4"></div>
          <button onclick="closeModal()">Close</button>
        </div>
      `;
        document.body.appendChild(modal);

        const modalHistory = document.getElementById("modal-history");
        if (history.length === 0) {
          modalHistory.innerHTML =
            '<p class="text-gray-600">No chat history available.</p>';
        } else {
          history.forEach((item, index) => {
            const historyItem = document.createElement("div");
            historyItem.className = "bg-gray-50 p-4 rounded-lg";
            historyItem.innerHTML = `
            <p class="font-semibold text-gray-900">Q: ${item.question}</p>
            <p class="text-gray-600">A: ${item.answer}</p>
          `;
            modalHistory.appendChild(historyItem);
          });
        }
      }

      function exportChat(page) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        let yOffset = 10;

        doc.setFontSize(16);
        doc.text(
          `${page === "general" ? "AI" : "PDF"} Chat History`,
          10,
          yOffset
        );
        yOffset += 10;

        doc.setFontSize(12);
        messages[page].forEach((msg, index) => {
          const prefix = msg.sender === "user" ? "You: " : "AI: ";
          const text = `${prefix}${msg.text
            .replace(/<b>/g, "")
            .replace(/<\/b>/g, "")}`;
          const lines = doc.splitTextToSize(text, 180);
          doc.text(lines, 10, yOffset);
          yOffset += lines.length * 7 + 5;
          if (yOffset > 270) {
            doc.addPage();
            yOffset = 10;
          }
        });

        doc.save(`${page === "general" ? "AI" : "PDF"}_Chat_History.pdf`);
      }

      function showLoginModal() {
        const modal = document.createElement("div");
        modal.className = "modal";
        modal.innerHTML = `
        <div class="modal-content">
          <h3 class="text-2xl font-bold text-gray-900 mb-4">Login</h3>
          <div>
            <label for="login-email">Email</label>
            <input type="email" id="login-email" placeholder="Your email" required />
          </div>
          <div>
            <label for="login-password">Password</label>
            <input type="password" id="login-password" placeholder="Your password" required />
          </div>
          <button onclick="login()">Login</button>
          <button onclick="closeModal()">Cancel</button>
        </div>
      `;
        document.body.appendChild(modal);
      }

      function showSignupModal() {
        const modal = document.createElement("div");
        modal.className = "modal";
        modal.innerHTML = `
        <div class="modal-content">
          <h3 class="text-2xl font-bold text-gray-900 mb-4">Sign Up</h3>
          <div>
            <label for="signup-username">Username</label>
            <input type="text" id="signup-username" placeholder="Your username" required />
          </div>
          <div>
            <label for="signup-email">Email</label>
            <input type="email" id="signup-email" placeholder="Your email" required />
          </div>
          <div>
            <label for="signup-password">Password</label>
            <input type="password" id="signup-password" placeholder="Your password" required />
          </div>
          <button onclick="signup()">Sign Up</button>
          <button onclick="closeModal()">Cancel</button>
        </div>
      `;
        document.body.appendChild(modal);
      }

      function login() {
        const email = document.getElementById("login-email")?.value;
        const password = document.getElementById("login-password")?.value;
        if (email && password) {
          alert("Login attempt with email: " + email);
          closeModal();
        } else {
          alert("Please fill in all fields");
        }
      }

      function signup() {
        const username = document.getElementById("signup-username")?.value;
        const email = document.getElementById("signup-email")?.value;
        const password = document.getElementById("signup-password")?.value;
        if (username && email && password) {
          alert(
            "Sign up attempt with username: " + username + ", email: " + email
          );
          closeModal();
        } else {
          alert("Please fill in all fields");
        }
      }

      function submitContactForm() {
        const name = document.getElementById("contact-name").value;
        const email = document.getElementById("contact-email").value;
        const message = document.getElementById("contact-message").value;
        if (name && email && message) {
          alert(
            "Contact form submitted:\nName: " +
              name +
              "\nEmail: " +
              email +
              "\nMessage: " +
              message
          );
          document.getElementById("contact-name").value = "";
          document.getElementById("contact-email").value = "";
          document.getElementById("contact-message").value = "";
        } else {
          alert("Please fill in all fields");
        }
      }

      function logout() {
        alert("Log Out functionality would be implemented here.");
      }

      function closeModal() {
        const modal = document.querySelector(".modal");
        if (modal) modal.remove();
      }

      pdfUpload.addEventListener("change", async function () {
        const file = this.files[0];
        if (file && file.type === "application/pdf") {
          messages.pdf.push({
            sender: "user",
            text: `Uploaded file: ${file.name}`,
          });
          firstLoad.pdf = false;
          if (currentPage === "pdf") renderMessages("pdf");

          const reader = new FileReader();
          reader.onload = async function () {
            const typedArray = new Uint8Array(reader.result);
            const pdf = await pdfjsLib.getDocument({ data: typedArray })
              .promise;

            let fullText = "";
            for (let i = 1; i <= pdf.numPages; i++) {
              const page = await pdf.getPage(i);
              const textContent = await page.getTextContent();
              const pageText = textContent.items
                .map((item) => item.str)
                .join(" ");
              fullText += pageText + "\n";
            }

            pdfText = fullText;
            alert(
              "PDF uploaded and processed. You can now ask questions about it!"
            );
          };
          reader.readAsArrayBuffer(file);
          pdfUpload.value = "";
        }
      });

      generalInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") sendMessage("general");
      });

      pdfInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") sendMessage("pdf");
      });

      navigate("home");
    </script>
  </body>
</html>
